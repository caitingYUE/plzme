<!--pages/scripts/scripts.wxml-->
<view class="scripts-page page-container">
  <!-- ç²¾é€‰å‰§æœ¬ -->
  <view class="category-section">
    <view class="category-header">
      <text class="category-title">ç²¾é€‰å‰§æœ¬</text>
      <text class="more-btn" bindtap="viewMore" data-category="featured">æ›´å¤š</text>
    </view>
    
    <scroll-view class="horizontal-scroll" scroll-x enable-flex>
      <view class="featured-cards">
        <view 
          class="featured-card"
          wx:for="{{featuredScripts}}" 
          wx:key="id"
          bindtap="goToScript"
          data-id="{{item.id}}"
        >
          <view class="featured-image-container">
            <image src="{{item.cover}}" class="featured-image" mode="aspectFill" />
            <view class="featured-overlay">
              <text class="featured-title">{{item.title}}</text>
              <text class="featured-desc">{{item.description}}</text>
              <view class="featured-stats">
                <text class="featured-rating">â­ {{item.rating}}</text>
                <text class="featured-count">{{item.playCount}}äººä½“éªŒ</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ–°å¢å‰§æœ¬ -->
  <view class="category-section">
    <view class="category-header">
      <text class="category-title">æ–°å¢å‰§æœ¬</text>
      <text class="more-btn" bindtap="viewMore" data-category="new">æ›´å¤š</text>
    </view>
    
    <scroll-view class="horizontal-scroll" scroll-x enable-flex>
      <view class="script-cards">
        <view 
          class="script-card"
          wx:for="{{newScripts}}" 
          wx:key="id"
          bindtap="goToScript"
          data-id="{{item.id}}"
        >
          <view class="script-image-container">
            <image src="{{item.cover}}" class="script-image" mode="aspectFill" />
            <!-- æ–°å“æ ‡è¯† -->
            <view class="new-badge">æ–°</view>
          </view>
          <view class="script-info">
            <text class="script-title">{{item.title}}</text>
            <text class="script-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æˆ‘ä»¬æ˜¯ä»€ä¹ˆå…³ç³» -->
  <view class="category-section" wx:if="{{relationshipScripts.length > 0}}">
    <view class="category-header">
      <text class="category-title">æˆ‘ä»¬æ˜¯ä»€ä¹ˆå…³ç³»</text>
      <text class="more-btn" bindtap="viewMore" data-category="relationship">æ›´å¤š</text>
    </view>
    
    <scroll-view class="horizontal-scroll" scroll-x enable-flex>
      <view class="script-cards">
        <view 
          class="script-card"
          wx:for="{{relationshipScripts}}" 
          wx:key="id"
          bindtap="goToScript"
          data-id="{{item.id}}"
        >
          <view class="script-image-container">
            <image src="{{item.cover}}" class="script-image" mode="aspectFill" />
          </view>
          <view class="script-info">
            <text class="script-title">{{item.title}}</text>
            <text class="script-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœ¦èƒ§çš„æƒ…æ„« -->
  <view class="category-section" wx:if="{{crushScripts.length > 0}}">
    <view class="category-header">
      <text class="category-title">æœ¦èƒ§çš„æƒ…æ„«</text>
      <text class="more-btn" bindtap="viewMore" data-category="crush">æ›´å¤š</text>
    </view>
    
    <scroll-view class="horizontal-scroll" scroll-x enable-flex>
      <view class="script-cards">
        <view 
          class="script-card"
          wx:for="{{crushScripts}}" 
          wx:key="id"
          bindtap="goToScript"
          data-id="{{item.id}}"
        >
          <view class="script-image-container">
            <image src="{{item.cover}}" class="script-image" mode="aspectFill" />
          </view>
          <view class="script-info">
            <text class="script-title">{{item.title}}</text>
            <text class="script-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ä¸èƒ½è¯´çš„ç§˜å¯† -->
  <view class="category-section" wx:if="{{secretScripts.length > 0}}">
    <view class="category-header">
      <text class="category-title">ä¸èƒ½è¯´çš„ç§˜å¯†</text>
      <text class="more-btn" bindtap="viewMore" data-category="secret">æ›´å¤š</text>
    </view>
    
    <scroll-view class="horizontal-scroll" scroll-x enable-flex>
      <view class="script-cards">
        <view 
          class="script-card"
          wx:for="{{secretScripts}}" 
          wx:key="id"
          bindtap="goToScript"
          data-id="{{item.id}}"
        >
          <view class="script-image-container">
            <image src="{{item.cover}}" class="script-image" mode="aspectFill" />
          </view>
          <view class="script-info">
            <text class="script-title">{{item.title}}</text>
            <text class="script-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å¿ƒè·³çš„å£°éŸ³ -->
  <view class="category-section" wx:if="{{heartbeatScripts.length > 0}}">
    <view class="category-header">
      <text class="category-title">å¿ƒè·³çš„å£°éŸ³</text>
      <text class="more-btn" bindtap="viewMore" data-category="heartbeat">æ›´å¤š</text>
    </view>
    
    <scroll-view class="horizontal-scroll" scroll-x enable-flex>
      <view class="script-cards">
        <view 
          class="script-card"
          wx:for="{{heartbeatScripts}}" 
          wx:key="id"
          bindtap="goToScript"
          data-id="{{item.id}}"
        >
          <view class="script-image-container">
            <image src="{{item.cover}}" class="script-image" mode="aspectFill" />
          </view>
          <view class="script-info">
            <text class="script-title">{{item.title}}</text>
            <text class="script-desc">{{item.description}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{allScripts.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ“š</view>
    <view class="empty-text">æš‚æ— å‰§æœ¬</view>
    <view class="empty-desc">ç¨åå†æ¥çœ‹çœ‹å§</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="floating-add-btn" bindtap="goToCreateScript">
    <text class="add-icon">+</text>
  </view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view class="filter-modal {{showFilterModal ? 'show' : ''}}" bindtap="hideFilter">
  <view class="filter-content" catchtap="preventClose">
    <view class="filter-header">
      <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
      <text class="filter-close" bindtap="hideFilter">âœ•</text>
    </view>
    
    <view class="filter-body">
      <!-- ç±»å‹ç­›é€‰ -->
      <view class="filter-group">
        <view class="group-title">å‰§æœ¬ç±»å‹</view>
        <view class="option-list">
          <view 
            class="option-item {{filterOptions.type === item.key ? 'selected' : ''}}"
            wx:for="{{typeOptions}}" 
            wx:key="key"
            bindtap="selectFilter"
            data-type="type"
            data-value="{{item.key}}"
          >
            {{item.label}}
          </view>
        </view>
      </view>

      <!-- æƒ…æ„Ÿä¸»é¢˜ç­›é€‰ -->
      <view class="filter-group">
        <view class="group-title">æƒ…æ„Ÿä¸»é¢˜</view>
        <view class="option-list">
          <view 
            class="option-item {{filterOptions.emotion === item.key ? 'selected' : ''}}"
            wx:for="{{emotionOptions}}" 
            wx:key="key"
            bindtap="selectFilter"
            data-type="emotion"
            data-value="{{item.key}}"
          >
            {{item.label}}
          </view>
        </view>
      </view>

      <!-- éš¾åº¦ç­›é€‰ -->
      <view class="filter-group">
        <view class="group-title">æƒ…æ„Ÿæ·±åº¦</view>
        <view class="option-list">
          <view 
            class="option-item {{filterOptions.difficulty === item.key ? 'selected' : ''}}"
            wx:for="{{difficultyOptions}}" 
            wx:key="key"
            bindtap="selectFilter"
            data-type="difficulty"
            data-value="{{item.key}}"
          >
            {{item.label}}
          </view>
        </view>
      </view>
    </view>
    
    <view class="filter-footer">
      <button class="btn btn-secondary" bindtap="resetFilter">é‡ç½®</button>
      <button class="btn btn-primary" bindtap="applyFilter">ç¡®å®š</button>
    </view>
  </view>
</view>