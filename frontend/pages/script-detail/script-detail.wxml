<!--pages/script-detail/script-detail.wxml-->
<view class="script-detail-page page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å‰§æœ¬å†…å®¹ -->
  <view wx:elif="{{scriptData}}">
    <!-- å‰§æœ¬å°é¢åŒºåŸŸ -->
    <view class="script-cover">
      <image src="{{scriptData.coverImage}}" class="cover-image" mode="aspectFill"></image>
      <!-- äººç¾¤æ ‡ç­¾ï¼ˆè¦†ç›–åœ¨å›¾ç‰‡å³ä¸‹è§’ï¼‰ -->
      <view class="script-type-badge" wx:if="{{scriptData.tags && scriptData.tags.length > 0}}">
        <text class="script-type-text">{{scriptData.tags[0]}}</text>
      </view>
      <view class="cover-overlay">
        <view class="script-info">
          <view class="script-title">{{scriptData.title}}</view>
        </view>
      </view>
    </view>

    <!-- å‰§æœ¬ç®€ä»‹ -->
    <view class="script-content">
      <view class="section">
        <view class="section-title">å‰§æœ¬ç®€ä»‹</view>
        <view class="section-content">
          <text class="description">{{scriptData.description}}</text>
        </view>
      </view>

      <!-- æƒ…æ„Ÿæ ‡ç­¾ï¼ˆè·³è¿‡ç¬¬ä¸€ä¸ªäººç¾¤æ ‡ç­¾ï¼Œæœ€å¤šæ˜¾ç¤º3ä¸ªï¼‰ -->
      <view class="section" wx:if="{{scriptData.tags && scriptData.tags.length > 1}}">
        <view class="section-title">æƒ…æ„Ÿæ¢ç´¢</view>
        <view class="emotion-tags">
          <view 
            class="emotion-tag" 
            wx:for="{{scriptData.tags}}" 
            wx:for-index="tagIndex"
            wx:key="*this"
            wx:if="{{tagIndex > 0 && tagIndex <= 3}}"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- è§’è‰²è®¾å®š -->
      <view class="section">
        <view class="section-title">è§’è‰²è®¾å®š</view>
        <view class="role-info">
          <view class="role-item">
            <view class="role-name">ä½ çš„è§’è‰²</view>
            <view class="role-desc">{{scriptData.userRole}}</view>
          </view>
          <view class="role-item">
            <view class="role-name">AIè§’è‰²</view>
            <view class="role-desc">{{scriptData.aiRole}}</view>
          </view>
        </view>
      </view>

      <!-- é¢„æœŸæ”¶è· -->
      <view class="section" wx:if="{{scriptData.benefits && scriptData.benefits.length > 0}}">
        <view class="section-title">é¢„æœŸæ”¶è·</view>
        <view class="benefits">
          <view 
            class="benefit-item" 
            wx:for="{{scriptData.benefits}}" 
            wx:key="*this"
          >
            <text class="benefit-icon">âœ¨</text>
            <text class="benefit-text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- åœºæ™¯åˆ—è¡¨ -->
      <view class="section" wx:if="{{scriptData.scenes && scriptData.scenes.length > 0}}">
        <view class="section-title">åœºæ™¯</view>
        <view class="scenes-list">
          <view 
            class="scene-item" 
            wx:for="{{scriptData.scenes}}" 
            wx:key="name"
          >
            <view class="scene-header">
              <text class="scene-title">{{index + 1}}. {{item.name}}</text>
              <text class="scene-time" wx:if="{{item.time}}">{{item.time}}</text>
            </view>
            <text class="scene-desc">{{item.description}}</text>
            <view class="scene-details" wx:if="{{item.location || item.action}}">
              <text class="scene-location" wx:if="{{item.location}}">ğŸ“ {{item.location}}</text>
              <text class="scene-action" wx:if="{{item.action}}">ğŸ¬ {{item.action}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨å®‰å…¨é—´è· -->
      <view class="bottom-safe-area"></view>
    </view>

    <!-- å›ºå®šåº•éƒ¨æ“ä½œåŒº -->
    <view class="fixed-action-section">
      <view class="action-buttons">
        <!-- ä»…è‡ªå®šä¹‰å‰§æœ¬æ˜¾ç¤ºæŠ•ç¨¿å’Œå¼€å§‹ä½“éªŒæŒ‰é’®ï¼Œæ— æ”¶è—æŒ‰é’® -->
        <block wx:if="{{isCustomScript}}">
          <button class="btn btn-outline submit-btn" bindtap="submitScript">
            <text class="btn-icon">ğŸ“®</text>
            <text class="btn-text">æŠ•ç¨¿</text>
          </button>
          <button class="btn btn-primary start-btn" bindtap="startScript">
            <text class="btn-text">å¼€å§‹ä½“éªŒ</text>
          </button>
        </block>
        <!-- éè‡ªå®šä¹‰å‰§æœ¬æ˜¾ç¤ºåŸæœ‰æŒ‰é’® -->
        <block wx:else>
          <button class="btn btn-secondary collect-btn" bindtap="toggleCollect">
            <text class="btn-icon">{{isCollected ? 'â™¥' : 'â™¡'}}</text>
            <text class="btn-text">{{isCollected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
          </button>
          <button class="btn btn-primary start-btn" bindtap="startScript">
            <text class="btn-text">å¼€å§‹ä½“éªŒ</text>
          </button>
        </block>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:else>
    <text>æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</text>
  </view>
</view>